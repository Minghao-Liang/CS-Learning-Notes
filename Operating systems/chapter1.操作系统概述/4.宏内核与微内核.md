# 宏内核与微内核

## 宏内核

前面谈到CPU可以执行不同的模式，如果整个操作系统都驻留在内核中，操作系统所有的模块实现都在supervisor mode下运行，那么这种组织方式就被称为宏内核（monolithic kernel），又称为单内核。例如xv6就是一个宏内核的操作系统。

这种组织方式非常方便，设计者无需考虑那一部分不需要硬件的特权，而且操作系统的不同部分之间合作起来也更加方便，各种子模块紧密连接在一起也使得系统具有更好的性能。

但是，在宏内核中，任何一个bug都有可能成为漏洞，牵一发而动全身。如果这个操作系统有大量的代码，出现严重bug的可能性也更大。而如今的操作系统都具有巨量的代码，在这种情况下宏内核很难满足特定场景下对安全性、可靠性等方面的需求。

## 微内核

除此之外，还具有另一种组织方式，称为微内核（microkernel）。设计者将操作系统的单个功能或者模块从内核中拆分出来，在user mode下执行大部分的功能，仅在内核中运行少部分的代码。在微内核中，各个模块之间相互隔离，在安全性方面可以做得更好，而且独立的模块也能更好地为不同场景定制不一样的功能。

但是与此同时，微内核的性能会更差，因为微内核需要在两种模式之间不断地跳转切换，而且各个模块之间也很难共享资源。事实上，微内核的性能就一定差吗？有研究者指出性能较差不是微内核的必然结果。

在实际中，两种设计都有出现，历史上大部分桌面操作系统都是宏内核，而很多嵌入式系统是微内核。关于宏内核与微内核之间的讨论也远没有这么简单。